{% extends 'base.html' %}
{% block content %}
<style>
    .fp-otp-card {
        border: none;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        background: #fff;
    }
    .fp-otp-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        padding: 28px 24px;
        text-align: center;
    }
    .fp-otp-header h2 {
        margin: 0;
        font-weight: 800;
    }
    .fp-otp-subtitle {
        color: rgba(255,255,255,0.9);
        margin-top: 8px;
        font-size: 0.95rem;
    }
    .otp-input {
        height: 58px;
        text-align: center;
        font-size: 1.6rem;
        border-radius: 14px;
        border: 2px solid #e9ecef;
        transition: all 0.2s ease;
    }
    .otp-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102,126,234,0.15);
    }
    .resend-disabled {
        pointer-events: none;
        opacity: 0.6;
    }
</style>

<div class="row justify-content-center">
  <div class="col-md-7 col-lg-6 col-xl-5">
    <div class="fp-otp-card">
      <div class="fp-otp-header">
        <h2><i class="bi bi-shield-lock"></i> Verify OTP</h2>
        <div class="fp-otp-subtitle">
          We sent a 6-digit code to your email for <strong>{{ username }}</strong>.
        </div>
      </div>
      <div class="p-4 p-lg-5">
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}

        <form method="post" id="otpForm" novalidate>
          {% csrf_token %}

          <label class="form-label" for="otp">Enter OTP Code</label>
          <input type="text"
                 inputmode="numeric"
                 pattern="[0-9]{6}"
                 maxlength="6"
                 class="form-control form-control-lg otp-input"
                 name="otp"
                 id="otp"
                 placeholder="000000"
                 required
                 autofocus>
          <small class="text-muted d-block mb-3">Enter the 6â€‘digit code to continue resetting your password.</small>

          <div class="d-grid gap-2 mb-4">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="bi bi-check2-circle"></i> Verify OTP
            </button>
          </div>
        </form>

        <div class="text-center">
          <p class="mb-2">
            <a id="resendLink" href="{% url 'accounts:resend_reset_otp' %}" class="text-decoration-none">
              <i class="bi bi-arrow-clockwise"></i> Resend OTP <span id="resendTimer" class="text-muted">(60s)</span>
            </a>
          </p>
          <p class="mb-0">
            <a href="{% url 'accounts:forgot_password' %}" class="text-decoration-none">
              <i class="bi bi-arrow-left"></i> Back to Forgot Password
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    const otpInput = document.getElementById('otp');
    const form = document.getElementById('otpForm');
    const resendLink = document.getElementById('resendLink');
    const timerEl = document.getElementById('resendTimer');

    if (form) {
      form.addEventListener('submit', (e) => {
        if (!otpInput || !/^[0-9]{6}$/.test(otpInput.value)) {
          e.preventDefault();
          if (otpInput) otpInput.focus();
        }
      });
    }

    let remaining = 60;
    if (resendLink) resendLink.classList.add('resend-disabled');
    const tick = () => {
      remaining -= 1;
      if (timerEl) timerEl.textContent = `(${remaining}s)`;
      if (remaining <= 0) {
        if (resendLink) resendLink.classList.remove('resend-disabled');
        if (timerEl) timerEl.textContent = '';
        clearInterval(interval);
      }
    };
    const interval = setInterval(tick, 1000);
  })();
</script>
{% endblock %}


